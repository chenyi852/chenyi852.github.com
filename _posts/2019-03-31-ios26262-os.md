---
layout: post
title: "OS如何过ISO26262认证"
subtitle: '针对无人驾驶场景，分析主流OS架构如果遵循ISO2626要求'
author: "Johnny"
header-style: text
tags:
  - ISO26262
  - OS 
  - micro kernel
  - linux
---

随着ADAS（Advanced Driver Assistant System）的快速发展，无人驾驶也随着成为各大公司争夺的下一个战场。影响无人驾驶商业化的因素有很多，除了技术以外，还涉及到法律，交规等。在通过法律法规上，中国肯定会走在欧美国家的前面，毕竟中国ZF如果要决定要干一件事，就必定会全力以赴，集全国之力办成，这也是为什么***《2012》***电影中诺亚方舟由中国承建的原因。在我与德国ISO26262专家交流的过程也得到证实，没有数年的努力，无人驾驶在德国根本就无法从法律上通过。

我在前面啰嗦这么一大段的目的就是想说：如果能从技术方面能保障系统的可靠性，那么无人驾驶会很容易通过法律法规。那么ADAS过认证难在哪呢？因为AI算法的不确定性导致了ADAS无法被证明完全可靠，同时系统也无法检测ADAS的行为是否正确。例如：你无法证明ADAS决策踩油门这一行为是正确的。如果系统能证明这一行为是正确的，那么你就可以ADAS是可靠的。

虽然上层软件不是强制要求达到ISO2626的ASILD的，但是却要求在上层软件出错时，底层软件或者系统能检测楚上层软件出错。试问底层软件不能达到ASILD，那么你怎么能保证底层软件是可靠的，怎么能保证底层软件能检测出上层软件出错呢？传统的汽车使用的CAN总线的链接层可以是QM级别的，但是要求端侧能检测出链接层传输的错误，并予以纠正，这样可以保证整个CAN总线达到ASILD级别。也就是说ISO26262认为只要系统有模块能检测出某安全级别低级别组件的错误，那么二者加起来就能达到检测模块的级别。那么就需要OS尽可能达到最高的级别ASILD，这样才能保证OS上运行的检测软件能检测其他组件的错误，并进入安全模式。

既然OS有诉求需要达到ASILD，那么是否是否ADAS运行的主流平台ubuntu 能达到ASILD呢？

答案是***不能***，为什么呢？两个原因：

- ubuntu的内核时Linux，属于宏内核，TCB（trust code base)过大，无法做到函数级别的证明其可靠性，需要巨大的人力物力。就算我天朝有996，但是裁判是德国人（[TÜV Rheinland](https://www.tuv.com/greater-china/cn/)和[TÜV南德](https://www.tuv-sud.cn/cn-scn)都在德国，总部分别在德国的科隆与慕尼黑)可是965加一月的年假。
- ubuntu基于开源社区，开发流程无法控制，所以流程方面无法满足ISO26262的要求。

那么只能另辟蹊径，目前德国公司从事ADAS研究的主要2大Tire1公司Vector和Elektrobit分别选择PikeOS和QNX作为操作系统。那么PIkeOS和QNX有啥共同点呢？为什么会得到vector和EB的青睐呢？二者都是采用Micro Kernel架构，均提供Hypervisor。

- 采用Micro kernel架构的其中好处之一是TCB小，相对的过认证（不管是ISO26262还是EAL认证）的工作量相对小。
- 采用Micro Kernel架构的另一好处是外设驱动均在用户态，根据某论文统计，Linux内核绝大部分bug都在驱动中。将这样一个定时炸弹从内核拿掉，那么内核会更健壮。
- 采用micro kernel架构的第三大好处，其Capability能力可以控制各进程的权限与资源分配，保证权限与资源不被用户 滥用。
- 采用hypervisor的好处是可以在虚拟机中运行Linux，因为ADAS目前的生态基于Ubuntu，而微内核如果要重复造轮子，从开发及运营成本上考虑看不是一家公司能负荷过来的。
- 采用hypervisor的另一好处就是可以将安全域与非安全域彻底隔离。

相信在无人驾驶这种对可靠性，对Safety&Security有更高要求的领域，微内核有更大地用武之地。IOT网关也是微内核地一大应用场景之一。所以说：微内核地春天来了！

#### 参考

- 1 [知乎对ADAS的介绍](https://zhuanlan.zhihu.com/p/37521347)